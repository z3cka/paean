<!doctype html>
<html> 
<head> 
  <title>Paean via Backbone, Bootstrap & localStorage</title>
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="bootstrap/css/bootstrap-responsive.min.css">
  <link rel="stylesheet" href="css/overrides.css">
</head> 
<body>

  <div class="container">
    <h1>Thank You Lists</h1>
    <hr />
    <div class="page"></div>
  </div>

  <script type="text/template" id="thank-lists-template">
    <form id="add-list">
      <input type="text" name="list_title" />
      <button type="submit" class="btn btn-primary">Add List</button>
    </form>
  </script>

  <script type="text/template" id="thank-list-template">
  <a href="#/add" class="btn btn-primary">Thank Someone</a>
  <hr />
  <table class="table striped">
    <thead>
      <th>Name</th>
      <th>Gift</th>
    </thead>
    <tbody>
      <% _.each(thanks, function(thank) { %>
        <tr>
          <td><%= thank.get('name') %></td>
          <td><%= thank.get('gift') %></td>
          <td></td>
        </tr>
      <% }); %>
    </tbody>
  </table>

  </script>

  <script type="text/template" id="edit-thank-template">
    <form class="edit-thank-form">
      <legend>Thank Who?</legend>
      <label>Name</label>
      <input type="text" name="name" id="name" />
      <label>Gift</label>
      <input type="text" name="gift" id="gift" />
      <hr />
      <button type="submit" class="btn" id="edit-thank-submit-button">Add</button>
    </form>
  </script>

  <script src="js/libs/jquery.min.js" type="text/javascript"></script>
  <script src="js/libs/underscore-min.js" type="text/javascript"></script>
  <script src="js/libs/backbone-min.js"></script>
  <script src="js/libs/backbone.localStorage.js"></script>
  <script>
    $.fn.serializeObject = function() {
      var o = {};
      var a = this.serializeArray();
      $.each(a, function() {
        if (o[this.name] !== undefined) {
          if (!o[this.name].push) {
            o[this.name] = [o[this.name]];
          }
          o[this.name].push(this.value || '');
        } else {
          o[this.name] = this.value || '';
        }
      });
      return o;
    };
  </script>

  <script>
    // **************************************************** MODEL 
    var ThankListModel = Backbone.Model.extend({
      defaults: {
        list_title: 'Event I\'m thankful for' 
      }
      // thankSave: function () {
      // }
    });

    // **************************************************** COLLECTION
    var ThankListsCollection = Backbone.Collection.extend({
      model: ThankListModel,
      localStorage: new Store("thanks-backbone")
    });

    

    // **************************************************** VIEW
    var ThankListsView = Backbone.View.extend({
      el: '.page',
      render: function () {
        var template = _.template($('#thank-lists-template').html(), {});
        this.$el.html(template);
      },
      // Bind event for creating new lists
      events: {
        'submit #add-list': 'addList'
      },
      // do stuff on the above events
      addList: function (e) {
        // get data from the form and make it easy to use
        var listDetail = $(e.currentTarget).serializeObject();
        // put new list in list collection if the form is not blank
        if (listDetail.list_title.length > 0) {
          thankListsCollection.create(listDetail);
        }
        // clear the form
        this.input.val('');
        // prevent the form from reloading the page
        return false;
      }
    });

    // **************************************************** ROUTER
    var Router = Backbone.Router.extend({
      routes: {
        '': 'home'
      }
    });

    // make view
    var thankListsView = new ThankListsView();
    // make collection
    var thankListsCollection = new ThankListsCollection();

    var router = new Router();
    router.on('route:home', function () {
      // render the main view
      thankListsView.render();
    });
    Backbone.history.start();
  </script>
</body>
</html>
